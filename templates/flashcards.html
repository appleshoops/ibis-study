{% extends "base.html" %}
{% block title %}{{ set_title }} - Flashcards{% endblock %}
{% block content %}
    <h2 style="margin-bottom: 0.5em;">{{ set_title }}</h2>

    <style>
        .flashcard-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2em;
            justify-content: center;
            margin: 2em 0 2em 0;
        }
        .flashcard-flip {
            width: 320px;
            min-height: 120px;
            margin: 1em;
            perspective: 1200px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            min-height: 120px;
            /* Height adapts to tallest side below */
            transition: transform 0.45s cubic-bezier(.68,-0.55,.27,1.55);
            transform-style: preserve-3d;
        }
        .flashcard-flip .flashcard-inner {
            /* This is vital: allow growing for tallest side but don't force a fixed height. */
            height: auto;
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            min-height: 120px;
            box-sizing: border-box;
            border-radius: 15px;
            border: 2px solid #1c1b1b;
            box-shadow: 5px 5px #1c1b1b;
            padding: 1.5em 1.2em;
            font-size: 1.1rem;
            font-family: 'Manrope', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            cursor: pointer;
            backface-visibility: hidden;
            word-break: break-word;
            white-space: pre-line;
            left: 0;
            top: 0;
        }
        .flashcard-front {
            background: #fff;
            color: #252525;
            z-index: 2;
        }
        .flashcard-back {
            background: #6ce1a6;
            color: #1c1b1b;
            transform: rotateY(180deg);
            z-index: 3;
        }
        .flashcard-flip.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        /* Only the visible side should get the shadow highlight (optional) */
        .flashcard-flip:not(.flipped) .flashcard-front {
            box-shadow: 5px 5px #1c1b1b;
        }
        .flashcard-flip.flipped .flashcard-back {
            box-shadow: 5px 5px #1c1b1b;
        }
        .dashboard-btn-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 3em 0 1.5em 0;
            pointer-events: auto;
        }
        .back-to-dashboard-btn {
            width: 60vw;
            max-width: 400px;
            min-width: 200px;
            margin: 0 auto;
            font-size: 1.1em;
            text-decoration: none !important;
            display: block;
        }
        .back-to-dashboard-btn:link,
        .back-to-dashboard-btn:visited,
        .back-to-dashboard-btn:hover,
        .back-to-dashboard-btn:active {
            text-decoration: none !important;
        }
        a.back-to-dashboard-link {
            text-decoration: none !important;
        }
    </style>

    <div class="flashcard-container">
        {% for card in flashcards %}
            <div class="flashcard-flip" onclick="this.classList.toggle('flipped')">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <span>{{ card['front'] }}</span>
                    </div>
                    <div class="flashcard-back">
                        <span>{{ card['back'] }}</span>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <div class="dashboard-btn-wrapper">
        <a href="{{ url_for('dashboard') }}" class="back-to-dashboard-link">
            <button class="back-to-dashboard-btn">Back to Dashboard</button>
        </a>
    </div>
    <script>
      // This fixes the dynamic height so card doesn't jump or overlap
      for (const flip of document.querySelectorAll('.flashcard-flip')) {
        const inner = flip.querySelector('.flashcard-inner');
        const front = flip.querySelector('.flashcard-front');
        const back = flip.querySelector('.flashcard-back');
        function resizeFlip() {
          // get which is taller
          const maxHeight = Math.max(front.scrollHeight, back.scrollHeight);
          inner.style.height = maxHeight + "px";
        }
        // Adjust on load and on flip
        resizeFlip();
        flip.addEventListener('click', function() {
          setTimeout(resizeFlip, 310); // match transition
        });
        window.addEventListener('resize', resizeFlip);
      }
    </script>
{% endblock %}